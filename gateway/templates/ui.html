<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EV Payment Gateway Demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(145deg, #f8fbff, #eef3ff);
      min-height: 100vh;
      font-family: "Segoe UI", Roboto, sans-serif;
    }
    .navbar {
      background: #0d47a1 !important;
    }
    .navbar-brand {
      color: #fff !important;
      font-weight: 700;
    }
    .btn-outline-primary {
      color: #fff !important;
      border-color: #fff !important;
    }
    .btn-outline-primary:hover {
      background: #fff !important;
      color: #0d47a1 !important;
    }
    .page-title {
      text-align: center;
      font-weight: 700;
      color: #0d47a1;
      margin-bottom: 2rem;
      letter-spacing: .5px;
    }
    .card {
      border: 0;
      border-radius: 1.2rem;
      box-shadow: 0 8px 24px rgba(0,0,0,.08);
      transition: transform .25s ease;
    }
    .card:hover {
      transform: translateY(-3px);
    }
    .card-title {
      color: #0d47a1;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    .btn-primary {
      background: linear-gradient(90deg, #1976d2, #0d47a1);
      border: none;
      border-radius: 0.75rem;
      box-shadow: 0 4px 10px rgba(13,71,161,0.3);
      transition: all .2s;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(13,71,161,0.4);
    }
    .btn-dark {
      border-radius: 0.75rem;
    }
    .badge {
      font-size: .8rem;
      text-transform: capitalize;
      padding: .45em .75em;
      border-radius: .6em;
    }
    table th {
      background: #e8f0ff;
      color: #0d47a1;
    }
    footer {
      margin-top: 3rem;
      text-align: center;
      color: #777;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="/">‚ö° EV Trading Gateway</a>
    <div class="d-flex">
      <a class="btn btn-outline-primary" href="/payment/ui">Payment UI</a>
    </div>
  </div>
</nav>

<div class="container py-5">
  <h2 class="page-title">üí≥ Payment Gateway ‚Äì Demo Panel</h2>

  <div class="row g-4">
    <!-- Create Payment -->
    <div class="col-lg-6">
      <div class="card p-3">
        <div class="card-body">
          <h5 class="card-title">T·∫°o giao d·ªãch thanh to√°n</h5>
          <div class="row g-3">
            <div class="col-6">
              <label class="form-label">Order ID</label>
              <input id="orderId" class="form-control" value="1001"/>
            </div>
            <div class="col-6">
              <label class="form-label">S·ªë ti·ªÅn (VND)</label>
              <input id="amount" class="form-control" value="150000000"/>
            </div>
            <div class="col-6">
              <label class="form-label">Buyer ID</label>
              <input id="buyerId" class="form-control" value="501"/>
            </div>
            <div class="col-6">
              <label class="form-label">Seller ID</label>
              <input id="sellerId" class="form-control" value="302"/>
            </div>
            <div class="col-6">
              <label class="form-label">Ph∆∞∆°ng th·ª©c</label>
              <select id="method" class="form-select">
                <option value="e-wallet" selected>E-Wallet</option>
                <option value="banking">Banking</option>
              </select>
            </div>
            <div class="col-6">
              <label class="form-label">Provider</label>
              <input id="provider" class="form-control" value="DemoPay"/>
            </div>
            <div class="col-12 d-grid mt-2">
              <button id="btnCreate" class="btn btn-primary btn-lg shadow-sm">üöÄ T·∫°o thanh to√°n</button>
            </div>
            <div class="col-12">
              <div id="createMsg" class="text-muted small mt-2"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contract -->
    <div class="col-lg-6">
      <div class="card p-3">
        <div class="card-body">
          <h5 class="card-title">üìÑ H·ª£p ƒë·ªìng mua b√°n ƒëi·ªán t·ª≠</h5>
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">Payment ID</label>
              <input id="c_paymentId" class="form-control" placeholder="Nh·∫≠p ID t·ª´ b∆∞·ªõc thanh to√°n"/>
            </div>
            <div class="col-12">
              <label class="form-label">Ti√™u ƒë·ªÅ h·ª£p ƒë·ªìng</label>
              <input id="c_title" class="form-control" value="H·ª£p ƒë·ªìng mua b√°n xe ƒëi·ªán"/>
            </div>
            <div class="col-12">
              <label class="form-label">N·ªôi dung</label>
              <textarea id="c_content" class="form-control" rows="5">
B√™n A (Ng∆∞·ªùi b√°n) cam k·∫øt t√¨nh tr·∫°ng pin theo m√¥ t·∫£; 
B√™n B (Ng∆∞·ªùi mua) thanh to√°n ƒë·ªß s·ªë ti·ªÅn theo th·ªèa thu·∫≠n. 
Hai b√™n ƒë·ªìng √Ω k√Ω ƒëi·ªán t·ª≠ ƒë·ªÉ x√°c nh·∫≠n giao d·ªãch.
              </textarea>
            </div>
            <div class="col-12 d-grid">
              <button id="btnCreateContract" class="btn btn-dark">T·∫°o h·ª£p ƒë·ªìng</button>
            </div>
            <div class="col-12">
              <label class="form-label mt-3">Contract ID</label>
              <input id="s_contractId" class="form-control" placeholder="ID h·ª£p ƒë·ªìng v·ª´a t·∫°o"/>
            </div>
            <div class="col-12">
              <label class="form-label">Ng∆∞·ªùi k√Ω</label>
              <input id="s_signer" class="form-control" value="Nguy·ªÖn VƒÉn B"/>
            </div>
            <div class="col-12 d-grid">
              <button id="btnSign" class="btn btn-outline-primary">‚úçÔ∏è K√Ω ƒëi·ªán t·ª≠</button>
            </div>
            <div class="col-12">
              <div id="contractMsg" class="text-muted small mt-2"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- L·ªãch s·ª≠ thanh to√°n -->
    <div class="col-12">
      <div class="card p-3">
        <div class="card-body">
          <h5 class="card-title">üìú Danh s√°ch thanh to√°n g·∫ßn ƒë√¢y</h5>
          <table class="table table-striped" id="tblPayments">
            <thead><tr>
              <th>ID</th><th>Order</th><th>S·ªë ti·ªÅn</th><th>Tr·∫°ng th√°i</th><th>Ng√†y t·∫°o</th>
            </tr></thead>
            <tbody></tbody>
          </table>
          <p class="text-muted small mt-3">* D·ªØ li·ªáu m·∫´u demo ‚Äî c√≥ th·ªÉ thay b·∫±ng proxy GET t·ªõi <code>/payment-service/payment</code>.</p>
        </div>
      </div>
    </div>

  </div>
</div>

<footer>
  ¬© 2025 EV Payment Gateway | Designed for demo purpose
</footer>

<script>
function j(url, opts){ return fetch(url, Object.assign({headers:{'Content-Type':'application/json'}}, opts||{})); }

document.getElementById('btnCreate').onclick = async () => {
  const payload = {
    order_id: parseInt(document.getElementById('orderId').value || 0),
    buyer_id: parseInt(document.getElementById('buyerId').value || 0),
    seller_id: parseInt(document.getElementById('sellerId').value || 0),
    amount: parseInt(document.getElementById('amount').value || 0),
    method: document.getElementById('method').value,
    provider: document.getElementById('provider').value
  };
  const r = await j('/api/payments/create', {method:'POST', body: JSON.stringify(payload)});
  const data = await r.json();
  if(r.ok){
    const checkout = data.checkout_url || ('/payment/checkout/' + data.payment_id);
    window.location = checkout;
  }else{
    document.getElementById('createMsg').innerText = JSON.stringify(data);
  }
};

document.getElementById('btnCreateContract').onclick = async () => {
  const pid = parseInt(document.getElementById('c_paymentId').value || 0);
  const payload = {
    payment_id: pid,
    title: document.getElementById('c_title').value,
    content: document.getElementById('c_content').value
  };
  const r = await j('/api/contracts/create', {method:'POST', body: JSON.stringify(payload)});
  const data = await r.json();
  if(r.ok){
    document.getElementById('s_contractId').value = data.contract_id;
    document.getElementById('contractMsg').innerText = '‚úÖ T·∫°o h·ª£p ƒë·ªìng th√†nh c√¥ng (ID ' + data.contract_id + ')';
  }else{
    document.getElementById('contractMsg').innerText = JSON.stringify(data);
  }
};

document.getElementById('btnSign').onclick = async () => {
  const cid = parseInt(document.getElementById('s_contractId').value || 0);
  const signer = document.getElementById('s_signer').value;
  const r = await j('/api/contracts/sign', {method:'POST', body: JSON.stringify({contract_id:cid, signer_name: signer})});
  const data = await r.json();
  if(r.ok){
    document.getElementById('contractMsg').innerText = '‚úçÔ∏è ƒê√£ k√Ω h·ª£p ƒë·ªìng. JWT=' + data.signature_jwt.substring(0,40) + '...';
  }else{
    document.getElementById('contractMsg').innerText = JSON.stringify(data);
  }
};

function loadPaymentsDemo(){
  const tbody = document.querySelector('#tblPayments tbody');
  const rows = [
    {id: 3, order_id: 1003, amount: 120000000, status: 'pending',  created_at: new Date().toLocaleString()},
    {id: 2, order_id: 1002, amount: 150000000, status: 'paid',     created_at: new Date().toLocaleString()},
    {id: 1, order_id: 1001, amount: 320000000, status: 'canceled', created_at: new Date().toLocaleString()},
  ];
  tbody.innerHTML = rows.map(p =>
    `<tr>
      <td>${p.id}</td>
      <td>${p.order_id}</td>
      <td>${p.amount.toLocaleString()}‚Ç´</td>
      <td><span class="badge text-bg-${p.status==='paid'?'success':(p.status==='pending'?'secondary':'danger')}">${p.status}</span></td>
      <td>${p.created_at}</td>
    </tr>`
  ).join('');
}
loadPaymentsDemo();
</script>
</body>
</html>
