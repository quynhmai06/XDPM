services:
  db:
    image: postgres:16
    environment:
      POSTGRES_USER: ev
      POSTGRES_PASSWORD: evpass
      POSTGRES_DB: evdb
    volumes: [dbdata:/var/lib/postgresql/data]
    ports: ["5432:5432"]

  auth_service:
    build: ./auth-service
    environment:
      DATABASE_URL: postgresql+psycopg2://ev:evpass@db:5432/evdb
      JWT_SECRET: supersecret
    depends_on: [db]
    ports: ["5001:5001"] 

  admin_service:
    build: ./admin-service
    environment:
      DATABASE_URL: postgresql+psycopg2://ev:evpass@db:5432/evdb
      JWT_SECRET: supersecret
    depends_on: [db]
    ports: ["5002:5002"]   

  web_gateway:
    build: ./gateway
    ports:
      - "8000:8000"
    environment:
      AUTH_URL: http://auth_service:5001
      JWT_SECRET: devsecret
      GOOGLE_CLIENT_ID: "xxxxxxxxxxxx.apps.googleusercontent.com"
      GOOGLE_CLIENT_SECRET: "yyyyyyyyyyyy"


volumes:
  dbdata:
